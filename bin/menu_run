#!/bin/sh
cache_dir=${XDG_CACHE_HOME:-"$HOME/.cache"}
cache_file="$cache_dir/menu_run_cache"
history_file="$cache_dir/menu_run_history"

FZF_DEFAULT_OPTS='-e --bind=ctrl-u:page-up,ctrl-d:page-down,alt-o:print-query,ctrl-o:replace-query'
FZF_DEFAULT_OPTS="$FZF_DEFAULT_OPTS --history='$history_file' --scheme history"
export FZF_DEFAULT_OPTS

command_to_run="$({
    cat "$cache_file" 2>/dev/null || true
    {
        IFS=:
        for directory in ${PATH:-""}; do
            if [ -d "$directory" ]; then
                find "$directory" -maxdepth 1 -type f,l -executable -exec basename {} \;
            fi
        done | tee "$cache_file" &
    }
} | awk -W interactive '!commands[$0]++' | menu)"

$command_to_run
