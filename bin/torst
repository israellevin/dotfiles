#!/bin/bash
if [ "$1" == clean ]; then
    set -e
    sorted="$(for f in ~/torrents/torrent-stream/*/; do
        echo -e "$(ls "$f")\t$f"
    done | sort | cut -f2-)"
    for f in $sorted; do
        ls "$f"
        read q
        [ "$q" = d ] && rm -r "$f"
    done
    exit
elif [[ "$1" == magnet:* ]]; then
    magnet="$1"
else
    magnets="$(curl -s "https://thepiratebay10.org/search/$*" | grep -Pom10 '(?<= href=")magnet:[^"]*(?=")')"
    echo "$magnets" | grep -Po '(?<=&dn=)[^&]*' | nl -v0
    read -p '> ' q
    [ q = "$q" ] && exit 1
    magnet="$(echo "$magnets" | head -n $(($q + 1)) | tail -n 1)"
fi
echo "$magnet"

peerflix -l "$magnet" | sed -r "s:\x1B\[[0-9;]*[mK]::g" | grep '^[[:digit:]]'
read -p '> ' q
[ q = "$q" ] && exit 1
tmux split "read; vid - $*"
peerflix -i"$q" "$magnet"
exit 0
