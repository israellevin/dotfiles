#!/bin/bash
if [ "$1" == clean ]; then
    set -e
    sorted="$(for f in ~/torrents/torrent-stream/*/; do
        echo -e "$(ls "$f")\t$f"
    done | sort | cut -f2-)"
    for f in $sorted; do
        ls "$f"
        read q
        [ "$q" = d ] && rm -r "$f"
    done
    exit
elif [[ "$1" == magnet:* ]]; then
    magnet="$1"
else
    magnets="$(curl -s "https://thepiratebay10.org/search/$*" | grep -Pom10 '(?<= href=")magnet:[^"]*(?=")')"
    echo "$magnets" | grep -Po '(?<=&dn=)[^&]*' | nl
    read -p '> ' q
    [ q = "$q" ] && exit 1
    magnet="$(echo "$magnets" | head -n $q | tail -n 1)"
fi
echo "$magnet"
TMPDIR=$HOME/torrents peerflix -ln "$magnet" --mpv -- --volume-max=1000
exit 0
