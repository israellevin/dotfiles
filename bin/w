#!/bin/bash
if [ "$1" ]; then
    engine="$1"
    shift

    a=$*
    q=${a%-}
    [ "${a#$q}" ] && dump=yes
    q=${q/ /+}

    req="http://"
    case "$engine" in
        s) req="${req}duckduckgo.com/?q=$q";;
        g) req="${req}google.com/search?q=$q";;
        l) req="${req}google.com/search?q=$q&btnI=";;
        w) req="${req}en.wikipedia.org/w/index.php?title=Special:Search&search=$q&go=Go";;
        d) req="${req}dictionary.reference.com/browse/$q";;
        m) req="${req}morfix.co.il/$q";;
        h) req="${req}morfix.co.il/$q"; rtl=yes;;
        *) $0 l $engine $@; exit 0;;
    esac

    if [ "$dump" ]; then
        if [ "$rtl" ]; then
            w3m -dump "$req" | rev | more
        else
            w3m -dump "$req" | more
        fi
    else
        if [ "$rtl" ]; then
            rtl='+silent Heb'
        else
            rtl=''
        fi
        vi "+W3m $req" "+set nonumber" "+map q <Esc>:qa!<CR>" "$rtl"
    fi
else
    while read cmd; do
        $0 $cmd -
    done;
fi

exit 0
