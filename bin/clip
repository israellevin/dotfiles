#!/usr/bin/sh
if [ "$*" = --start ]; then
    wl-paste --watch cliphist store &
    wl-paste --primary --watch "$0" --delayed-store-primary &
elif [ "$*" = --delayed-store-primary ]; then
    old="$(wl-paste --primary)"
    sleep 0.1
    new="$(wl-paste --primary)"
    [ "$old" = "$new" ] && echo "$new" | cliphist store
elif [ "$*" = - ]; then
    cliphist list | menu --multi | cliphist delete
elif [ -f "$*" ]; then
    wl-copy < "$*"
elif [ "$*" ]; then
    wl-copy "$*"
elif [ ! -t 0 ] && readlink /proc/self/fd/0 | grep -q '^pipe:'; then
    exec wl-copy
else
    cliphist list | menu | cliphist decode | wl-copy
fi
